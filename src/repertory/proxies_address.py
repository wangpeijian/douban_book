import random

from util.url_tool import is_douban, is_xici

# 记录全部代理地址
PROXIES_IP = ["112.87.69.11:9999",
              "116.209.57.147:9999",
              "60.10.22.229:56086",
              "60.173.244.133:41306",
              "119.102.25.252:9999",
              "110.52.235.123:9999",
              "111.177.107.85:9999",
              "121.61.3.242:9999",
              "110.52.235.199:9999",
              "116.209.56.144:9999",
              "119.102.25.160:9999",
              "110.52.235.56:9999",
              "119.102.25.85:9999",
              "116.209.58.130:9999",
              "218.22.7.62:53281",
              "171.80.1.9:9999",
              "119.102.24.212:9999",
              "116.209.57.82:9999",
              "221.206.100.133:34073",
              "123.139.56.238:9999",
              "115.53.18.55:9999",
              "116.208.54.198:9999",
              "42.123.125.181:8088",
              "112.85.167.114:9999",
              "218.76.253.201:61408",
              "14.118.130.213:8081",
              "112.87.71.57:9999",
              "115.53.36.218:9999",
              "121.61.3.96:9999",
              "202.112.237.102:3128",
              "119.102.28.214:9999",
              "121.63.199.240:9999",
              "119.102.28.183:9999",
              "119.102.28.97:9999",
              "110.52.235.144:9999",
              "112.85.170.182:9999",
              "202.104.150.130:33163",
              "110.52.235.236:9999",
              "110.52.235.110:9999",
              "218.60.8.83:3129",
              "175.148.76.41:1133",
              "110.52.235.71:9999",
              "112.87.71.134:9999",
              "110.52.235.122:9999",
              "115.203.120.54:9999",
              "112.85.130.183:9999",
              "110.52.235.128:9999",
              "112.87.68.74:9999",
              "112.87.71.21:9999",
              "183.129.244.16:18118",
              "112.87.71.67:9999",
              "112.87.68.37:9999",
              "112.85.129.46:9999",
              "183.148.133.104:9999",
              "211.152.33.24:48749",
              "119.102.189.216:9999",
              "111.177.113.59:9999",
              "116.209.52.194:9999",
              "112.85.175.64:9999",
              "119.102.189.20:9999",
              "171.80.112.244:9999",
              "125.126.202.87:9999",
              "125.67.25.83:41681",
              "116.209.52.250:9999",
              "116.209.52.158:9999",
              "112.85.166.235:9999",
              "111.177.160.13:9999",
              "171.41.81.38:9999",
              "171.41.80.247:9999",
              "171.41.80.231:9999",
              "183.148.150.227:9999",
              "183.148.138.120:9999",
              "112.85.171.81:9999",
              "111.177.107.241:9999",
              "116.209.59.108:9999",
              "59.32.37.232:8010",
              "14.23.58.58:443",
              "112.85.172.100:9999",
              "125.126.221.193:9999",
              "111.177.163.99:9999",
              "125.126.194.113:9999",
              "111.177.187.66:9999",
              "111.177.181.19:9999",
              "111.177.184.101:9999",
              "116.209.54.154:9999",
              "121.61.3.18:9999",
              "112.85.171.20:18118",
              "58.241.186.90:43043",
              "183.148.151.166:9999",
              "112.85.171.243:9999",
              "110.52.235.171:9999",
              "115.221.125.56:25611",
              "36.26.227.111:9999",
              "183.148.143.123:9999",
              "111.177.182.102:9999",
              "112.85.128.16:9999",
              "110.52.235.237:9999",
              "111.177.113.101:9999",
              "112.85.129.169:9999",
              "14.20.235.7:808",
              ":",
              "110.52.235.32:9999",
              "112.85.129.206:9999",
              "218.87.239.168:9999",
              "183.148.141.212:9999",
              "218.91.112.11:9999",
              "110.52.235.121:9999",
              "111.198.104.169:808",
              "222.186.45.104:57622",
              "110.52.235.204:9999",
              "117.85.83.209:53128",
              "112.87.70.132:9999",
              "111.165.16.115:8118",
              "116.209.54.158:9999",
              "183.148.131.67:9999",
              "116.209.56.122:9999",
              "116.209.57.251:9999",
              "106.86.208.98:41683",
              "183.148.159.172:9999",
              "115.53.35.191:9999",
              "125.126.205.73:9999",
              "175.155.211.55:9999",
              "112.85.130.241:9999",
              "61.178.149.237:59042",
              "112.87.71.70:9999",
              "183.148.134.120:9999",
              "112.87.64.21:9999",
              "110.52.235.39:9999",
              "110.52.235.181:9999",
              "221.1.200.242:38652",
              "114.249.119.71:9000",
              "210.22.176.146:32153",
              "163.125.66.161:9797",
              "183.148.132.165:9999",
              "163.125.66.217:9797",
              "61.142.72.154:30074",
              "171.112.165.73:9999",
              "121.63.198.5:9999",
              "112.85.130.5:9999",
              "116.208.53.39:9999",
              "112.85.169.106:9999",
              "125.126.194.157:9999",
              "110.52.235.9:9999",
              "121.61.1.215:9999",
              "117.114.149.66:53281",
              "36.26.226.183:9999",
              "182.112.197.10:8118",
              "27.29.45.48:38109",
              "121.61.0.153:9999",
              "180.141.90.172:53281",
              "112.85.128.187:9999",
              "110.52.235.27:9999",
              "27.29.46.63:9999",
              "27.29.44.248:9999",
              "27.29.44.233:9999",
              "27.154.34.146:31527",
              "219.142.132.146:40655",
              "218.75.69.50:39590",
              "114.119.116.92:61066",
              "27.29.45.91:9999",
              "112.85.131.113:9999",
              "27.29.44.245:9999",
              "110.52.235.202:9999",
              "27.29.45.96:9999",
              "27.29.45.217:9999",
              "182.111.64.8:21776",
              "116.209.59.102:9999",
              "27.29.44.205:9999",
              "116.209.58.237:9999",
              "125.126.214.73:9999",
              "112.85.174.26:9999",
              "60.190.66.131:56882",
              "27.29.44.255:9999",
              "111.202.37.195:8080",
              "116.208.11.219:9999",
              "27.29.44.123:9999",
              "120.83.96.66:9999",
              "110.52.235.170:9999",
              "182.88.129.222:8123",
              "110.52.235.117:9999",
              "125.126.210.32:9999",
              "27.29.44.190:9999",
              "27.29.45.65:9999",
              "111.177.177.166:9999",
              "116.209.59.167:9999",
              "222.189.190.63:9999",
              "112.85.169.42:9999",
              "58.240.220.86:53281",
              "119.102.128.225:9999",
              "111.177.187.6:9999",
              "116.209.59.244:9999",
              "223.241.118.65:18118",
              "114.99.166.2:808",
              "110.52.235.126:9999",
              "218.87.239.251:9999",
              "110.52.235.243:9999",
              "116.209.59.192:9999",
              "171.211.26.42:808",
              "116.209.56.250:9999",
              "112.85.167.25:9999",
              "117.91.232.219:9999",
              ]

# 记录执行成功过的代理地址，获取地址时优先从成功过的地址获取
EFFECTIVE_PROXIES_IP = ["123.13.244.249:9999"]

# 记录豆瓣接口可使用的代理地址，豆瓣使用的代理地址和西刺的代理地址可能屏蔽的不一致，防止删掉能用的代理地址
EFFECTIVE_PROXIES_IP_DOU_BAN = ["123.13.244.249:9999"]


def remove_proxies_ip(url, proxies_ip):
    # 豆瓣屏蔽
    if is_douban(url):
        if proxies_ip in EFFECTIVE_PROXIES_IP_DOU_BAN:
            EFFECTIVE_PROXIES_IP_DOU_BAN.remove(proxies_ip)

    # 西刺屏蔽
    if is_xici(url):
        if proxies_ip in EFFECTIVE_PROXIES_IP:
            EFFECTIVE_PROXIES_IP.remove(proxies_ip)

    if proxies_ip in PROXIES_IP:
        PROXIES_IP.remove(proxies_ip)


def get_proxies_ip(url):
    # 豆瓣获取
    if is_douban(url):
        if len(EFFECTIVE_PROXIES_IP_DOU_BAN) > 0:
            return random.choice(EFFECTIVE_PROXIES_IP_DOU_BAN)

    # 西刺获取
    if is_xici(url):
        if len(EFFECTIVE_PROXIES_IP) > 0:
            return random.choice(EFFECTIVE_PROXIES_IP)

    if len(PROXIES_IP) > 0:
        return random.choice(PROXIES_IP)

    print("没有可用的代理地址了")
    return None


def add_proxies_ip(proxies_ip):
    if proxies_ip not in PROXIES_IP:
        PROXIES_IP.append(proxies_ip)


def add_effective_proxies_ip(proxies_ip):
    if proxies_ip not in EFFECTIVE_PROXIES_IP_DOU_BAN:
        EFFECTIVE_PROXIES_IP_DOU_BAN.append(proxies_ip)
        print("豆瓣,发现可用代理地址：", proxies_ip)

    if proxies_ip not in EFFECTIVE_PROXIES_IP:
        EFFECTIVE_PROXIES_IP.append(proxies_ip)
        print("西刺,发现可用代理地址：", proxies_ip)
